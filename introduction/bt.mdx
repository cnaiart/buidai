---
title: "宝塔面板部署"
description: "通过宝塔面板部署必定AI"
icon: 'server'
---

通过宝塔面板部署必定AI。本教程包含 **宝塔 Docker 部署** 和 **宝塔手动部署** 两种方式。

## 统一前置准备

<AccordionGroup>
  <Accordion title="最低配置要求" icon="server">
    *   **CPU**：≥2核（建议4核）
    *   **内存**：≥4GB RAM（建议8GB）
    *   **存储**：≥5GB 空闲空间
    *   **系统**：Ubuntu / Debian
  </Accordion>

  <Accordion title="Git 安装" icon="code-branch">
    如果您的系统尚未安装 Git，请根据系统类型执行安装命令：

    <CodeGroup>
      ```bash Ubuntu/Debian
      sudo apt update
      sudo apt install -y git
      ```
      ```bash CentOS/RHEL
      sudo yum install -y git
      ```
    </CodeGroup>

    验证安装是否成功：
    ```bash
    git --version
    # 输出版本信息则说明安装成功
    # git version 2.xx.x
    ```
  </Accordion>
</AccordionGroup>

<Steps>
  <Step title="获取源码">
    进入 `www/wwwroot` 目录，打开宝塔终端，执行以下命令：

    <CodeGroup>
      ```bash Gitee
      cd /www/wwwroot
      git clone https://gitee.com/BidingCC/BuildingAI.git ./buildingai
      ```
      ```bash Github
      cd /www/wwwroot
      git clone https://github.com/BidingCC/BuildingAI.git ./buildingai
      ```
    </CodeGroup>
  </Step>

  <Step title="配置环境变量">
    ```bash
    cd /www/wwwroot/buildingai
    cp .env.example .env
    ```

    您可以选择以下任一方式修改配置：

    *   **方式一（命令行）**：
        ```bash
        vi .env
        # 按 i 进入编辑模式
        # 修改 APP_DOMAIN 环境变量为准备部署的域名，例如 https://example.com
        # 修改完后按 ESC 然后输入 :wq 保存退出
        ```
    *   **方式二（文件管理）**：
        手动双击 `.env` 文件进行对应修改并保存文件。

    <Tip>
    如果前端需要请求其他域名，需要修改 `.env` 中的 `VITE_PRODUCT_APP_BASE_URL`，只请求本站则留空即可。
    </Tip>
  </Step>
</Steps>

## 开始安装

<Card title="选择部署方式" icon="settings">
  必定AI支持两种宝塔部署方式：
  *   **Docker 部署**：推荐新手使用，简单快捷。
  *   **手动部署**：适合有经验的用户，可深度定制。
</Card>

### 方式一：宝塔 Docker 部署

<Info>
**前提条件**：确保面板已安装 Docker 软件。
验证命令：
```bash
docker -v
# 输出下面内容表示已安装
# Docker version 28.x.x
```
</Info>

<Steps>
  <Step title="启动项目">
    ```bash
    cd /www/wwwroot/buildingai
    docker compose up -d
    ```
  </Step>
  <Step title="查看进度">
    等待约 1～2 分钟完全拉取镜像后，等待项目构建。可执行以下命令查看进度：

    ```bash
    docker logs buildingai-nodejs
    ```

    <Tip>
    也可以通过宝塔可视化面板进入 `buildingai-nodejs` 容器查看日志。
    </Tip>
  </Step>
</Steps>

### 方式二：宝塔手动部署

#### 1. 前置准备

请前往软件商店分别安装以下软件：
*   **PostgreSQL**：17.x
*   **Redis**：8.x 或 7.x
*   **Node.js 版本管理器**：安装后在其中安装 **Node.js 22.x** 版本，并设置命令行版本为该版本。

#### 2. PostgreSQL 进阶安装

手动部署需要编译安装 PostgreSQL 的扩展，请按照以下步骤操作：

<Steps>
  <Step title="下载并解压源码">
    ```bash
    cd /tmp
    # 清华大学pgsql镜像源
    wget https://mirrors.tuna.tsinghua.edu.cn/postgresql/source/v17.6/postgresql-17.6.tar.gz
    # 解压源码
    tar -zxvf postgresql-17.6.tar.gz
    cd postgresql-17.6
    ```
  </Step>

  <Step title="编译安装 (启用 uuid 支持)">
    ```bash
    # 这里的 /www/server/pgsql 是你宝塔安装的 pgsql 的目录
    ./configure --prefix=/www/server/pgsql --with-uuid=e2fs
    make && make install
    
    # 如果提示缺少 uuid 相关依赖则执行进行安装
    sudo apt install -y uuid-dev
    ```
  </Step>

  <Step title="编译官方内置拓展">
    ```bash
    cd contrib
    make && make install
    ```
  </Step>
</Steps>

#### 3. 安装第三方拓展

<AccordionGroup>
  <Accordion title="安装 zhparser (中文分词)">
    ```bash
    cd /tmp
    git clone https://github.com/amutu/zhparser.git
    cd zhparser
    make && make install

    # 如果报 scws 有关的错，先安装 scws 依赖：
    cd /tmp
    wget https://www.xunsearch.com/scws/down/scws-1.2.3.tar.bz2
    tar xjf scws-1.2.3.tar.bz2
    cd scws-1.2.3
    ./configure --prefix=/usr/local/scws
    make && make install

    # 如果报 No such file or directory，执行以下构建命令：
    make PG_CONFIG=/www/server/pgsql/bin/pg_config SCWS_HOME=/usr/local/scws
    make install make PG_CONFIG=/www/server/pgsql/bin/pg_config
    ```

    编译无误后，重新进入 zhparser 进行编译：
    ```bash
    cd /tmp/zhparser
    make PG_CONFIG=/www/server/pgsql/bin/pg_config SCWS_HOME=/usr/local/scws
    ```
  </Accordion>

  <Accordion title="安装 pgvector (向量搜索)">
    ```bash
    cd /tmp
    git clone https://github.com/pgvector/pgvector.git
    cd pgvector
    make && make install
    ```
  </Accordion>
</AccordionGroup>

#### 4. 激活拓展

切换到 `psql` 控制台并激活拓展（统一在 `buildingai` 数据库中执行）：

```bash
psql -U postgres -h localhost
```

```sql
-- 创建 buildingai 数据库
CREATE DATABASE buildingai;

-- 切换到 buildingai 数据库
\c buildingai

-- 激活需要的拓展
-- 官方内置拓展
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
-- 中文分词
CREATE EXTENSION IF NOT EXISTS zhparser;
-- 向量搜索
CREATE EXTENSION IF NOT EXISTS vector;
```

<Check>
到目前为止，数据库环境已准备完毕。
</Check>

#### 5. 部署项目

<Steps>
  <Step title="执行预部署脚本">
    进入项目目录，执行预部署脚本：
    ```bash
    cd /www/wwwroot/buildingai
    pnpm predeploy
    ```
    直到打印出必定AI的 Logo 和项目信息，说明环境准备完毕。
  </Step>

  <Step title="PM2 配置">
    1.  进入宝塔面板【站点】->【Node项目】，点击【添加项目】。
    2.  选择 **PM2项目**，添加方式选择【从文件/内容添加】，选择 `/www/wwwroot/buildingai/ecosystem.config.js` 配置文件。
    3.  填写端口号为 `.env` 配置的端口，运行用户选择为 `root`。
    4.  勾选【放行端口】，绑定域名为 `.env` 中配置的 `APP_DOMAIN`。
    5.  点击保存，等待项目启动。
  </Step>
</Steps>

<Success>
可以在 PM2 监控中查看项目状态和运行日志，状态为 **运行中** 说明项目启动成功。
</Success>
